// DiscoverPage.ets
import router from '@ohos.router';

@Entry
@Component
struct DiscoverPage {
  @State currentCategory: string = 'recommended'
  @State activeNav: string = 'discover'

  // çƒ­é—¨åˆ›ä½œè€…æ•°æ®
  @State channels: Array<Channel> = [
    { id: 1, name: 'èˆè¹ˆè¾¾äºº', avatar: 'media/images/profile1.jpg' },
    { id: 2, name: 'éŸ³ä¹åˆ¶ä½œäºº', avatar: 'media/images/profile2.jpg' },
    { id: 3, name: 'æ—…è¡Œè¾¾äºº', avatar: 'media/images/album_cover2.jpg' },
    { id: 4, name: 'ç¾é£Ÿåšä¸»', avatar: 'media/images/album_cover1.jpg' }
  ]

  // ä¸ºä½ æ¨èæ•°æ®
  @State recommendedItems: Array<RecommendedItem> = [
    {
      id: 1,
      title: 'ç²¾é€‰èˆè¹ˆæ•™å­¦ï¼šä»é›¶å¼€å§‹å­¦ä¹ è¡—èˆåŸºç¡€åŠ¨ä½œ',
      info: 'èˆè¹ˆè¾¾äºº Â· 2.3ä¸‡æ¬¡æ’­æ”¾',
      thumbnail: 'media/images/background1.jpg'
    },
    {
      id: 2,
      title: 'è½»éŸ³ä¹åˆé›†ï¼šåŠ©ä½ æ”¾æ¾å¿ƒæƒ…ï¼Œæé«˜å·¥ä½œæ•ˆç‡',
      info: 'éŸ³ä¹åˆ¶ä½œäºº Â· 1.8ä¸‡æ¬¡æ’­æ”¾',
      thumbnail: 'media/images/album_cover1.jpg'
    },
    {
      id: 3,
      title: 'åŸå¸‚æ—¥è½æ—¶åˆ†ï¼šæ•æ‰ç¾ä¸½å…‰å½±çš„æ‘„å½±æŠ€å·§',
      info: 'æ‘„å½±å¸ˆå°ç‹ Â· 1.5ä¸‡æ¬¡æ’­æ”¾',
      thumbnail: 'media/images/album_cover2.jpg'
    },
    {
      id: 4,
      title: 'å®¶å¸¸èœæ•™ç¨‹ï¼šç®€å•æ˜“å­¦çš„å¿«æ‰‹èœåˆ¶ä½œæ–¹æ³•',
      info: 'ç¾é£Ÿåšä¸» Â· 3.2ä¸‡æ¬¡æ’­æ”¾',
      thumbnail: 'media/images/profile2.jpg'
    }
  ]

  // æ­£åœ¨æµè¡Œæ•°æ®
  @State trendingCards: Array<TrendingCard> = [
    {
      id: 1,
      title: 'çƒ­é—¨è¡—èˆè§†é¢‘',
      info: '10.2ä¸‡æ¬¡æ’­æ”¾',
      image: 'media/images/background1.jpg'
    },
    {
      id: 2,
      title: 'çƒ­é—¨éŸ³ä¹æ¦œå•',
      info: '5.7ä¸‡æ¬¡æ’­æ”¾',
      image: 'media/images/album_cover1.jpg'
    }
  ]

  build() {
    Column() {
      // é¡¶éƒ¨å¯¼èˆªæ 
      Row() {
        Image($r('app.media.startIcon'))
          .width(24)
          .height(24)
          .margin({ left: 16 })
          .onClick(() => {
            router.back()
          })

        Text('å‘ç°')
          .fontSize(18)
          .fontWeight(FontWeight.Bold)
          .margin({ left: 16 })
          .layoutWeight(1)
          .textAlign(TextAlign.Center)
      }
      .width('100%')
      .height(56)
      .justifyContent(FlexAlign.Start)
      .alignItems(VerticalAlign.Center)
      // .border({ bottom: { width: 1, color: '#FFFFFF20' } })

      // æœç´¢æ 
      Row() {
        Image($r('app.media.startIcon'))
          .width(20)
          .height(20)
          .margin({ right: 10 })
          .opacity(0.7)

        TextInput({ placeholder: 'æœç´¢éŸ³ä¹ã€è§†é¢‘æˆ–åˆ›ä½œè€…' })
          .fontSize(14)
          .width('80%')
          .backgroundColor(Color.Transparent)
          .placeholderColor('#FFFFFFB3')
          .caretColor(Color.White)
      }
      .width('90%')
      .height(40)
      .backgroundColor('#FFFFFF1A')
      .borderRadius(20)
      .padding(10)
      .margin({ top: 10, bottom: 10 })
      // .alignSelf(FlexAlign.Center)

      // åˆ†ç±»æ ‡ç­¾
      Scroll() {
        Row() {
          ForEach(['recommended', 'hot', 'music', 'dance', 'game', 'food', 'travel'], (category :string) => {
            Text(this.getCategoryName(category))
              .fontSize(14)
              .padding({ left: 16, right: 16, top: 8, bottom: 8 })
              .borderRadius(20)
              .backgroundColor(this.currentCategory === category ? '#FF0050' : '#FFFFFF1A')
              .margin({ right: 15 })
              .onClick(() => {
                this.currentCategory = category
                // è¿™é‡Œå¯ä»¥æ·»åŠ åˆ†ç±»åˆ‡æ¢é€»è¾‘
              })
          })
        }
        .padding({ left: 16, right: 16, top: 10, bottom: 10 })
      }
      .scrollable(ScrollDirection.Horizontal)
      .width('100%')
      .height(48)
      // .border({ bottom: { width: 1, color: '#FFFFFF20' } })

      // å†…å®¹åŒºåŸŸ
      Scroll() {
        Column() {
          // æ­£åœ¨æµè¡Œéƒ¨åˆ†
          this.buildTrendingSection()

          // çƒ­é—¨åˆ›ä½œè€…éƒ¨åˆ†
          this.buildChannelsSection()

          // ä¸ºä½ æ¨èéƒ¨åˆ†
          this.buildRecommendedSection()
        }
        .width('100%')
      }
      .width('100%')
      .layoutWeight(1)
      .scrollBar(BarState.Off)

      // åº•éƒ¨å¯¼èˆªæ 
      Row() {
        this.buildNavItem('home', 'ğŸ ', 'é¦–é¡µ', 'index_main')
        this.buildNavItem('discover', 'ğŸ”', 'å‘ç°', 'discover')
        this.buildNavItem('create', '+', 'åˆ›å»º', 'create')
        this.buildNavItem('messages', 'ğŸ’¬', 'æ¶ˆæ¯', 'messages')
        this.buildNavItem('profile', 'ğŸ‘¤', 'æˆ‘', 'profile_center')
      }
      .width('100%')
      .height(60)
      .backgroundColor('#000000CC')
      // .border({ top: { width: 1, color: '#FFFFFF20' } })
      .justifyContent(FlexAlign.SpaceAround)
      .alignItems(VerticalAlign.Center)
    }
    .width('100%')
    .height('100%')
    .backgroundColor('#000000')
  }

  // æ„å»ºæ­£åœ¨æµè¡Œéƒ¨åˆ†
  @Builder
  buildTrendingSection() {
    Column() {
      // æ ‡é¢˜å’ŒæŸ¥çœ‹å…¨éƒ¨
      Row() {
        Text('æ­£åœ¨æµè¡Œ')
          .fontSize(18)
          .fontWeight(FontWeight.Bold)
          .layoutWeight(1)

        Text('æŸ¥çœ‹å…¨éƒ¨')
          .fontSize(14)
          .opacity(0.8)
          .onClick(() => {
            router.pushUrl({ url: 'pages/TrendingAll' })
          })
      }
      .width('100%')
      .margin({ bottom: 15 })

      // æµè¡Œå¡ç‰‡
      Grid() {
        ForEach(this.trendingCards, (card: TrendingCard) => {
          GridItem() {
            Stack() {
              Image($rawfile(card.image))
                .width('100%')
                .height(180)
                .objectFit(ImageFit.Cover)
                .opacity(0.8)

              Column() {
                Text(card.title)
                  .fontSize(16)
                  .fontWeight(FontWeight.Bold)
                  .margin({ bottom: 5 })

                Text(card.info)
                  .fontSize(12)
                  .opacity(0.8)
              }
              .width('100%')
              .padding(15)
              .alignItems(HorizontalAlign.Start)
              .justifyContent(FlexAlign.End)
              // .backgroundImage($rawfile('media/images/card_gradient.png'))
              .backgroundImageSize(ImageSize.Cover)
            }
            .width('100%')
            .height(180)
            .backgroundColor('#FFFFFF1A')
            .borderRadius(12)
            .onClick(() => {
              // è·³è½¬åˆ°è¯¦æƒ…é¡µ
            })
          }
          .padding(5)
        })
      }
      .columnsTemplate('1fr 1fr')
      .columnsGap(10)
      .rowsGap(10)
      .width('100%')
    }
    .padding(15)
    .width('100%')
  }

  // æ„å»ºçƒ­é—¨åˆ›ä½œè€…éƒ¨åˆ†
  @Builder
  buildChannelsSection() {
    Column() {
      // æ ‡é¢˜å’ŒæŸ¥çœ‹å…¨éƒ¨
      Row() {
        Text('çƒ­é—¨åˆ›ä½œè€…')
          .fontSize(18)
          .fontWeight(FontWeight.Bold)
          .layoutWeight(1)

        Text('æŸ¥çœ‹å…¨éƒ¨')
          .fontSize(14)
          .opacity(0.8)
          .onClick(() => {
            router.pushUrl({ url: 'pages/CreatorsAll' })
          })
      }
      .width('100%')
      .margin({ bottom: 15 })

      // åˆ›ä½œè€…åˆ—è¡¨
      Scroll() {
        Row() {
          ForEach(this.channels, (channel: Channel) => {
            Column() {
              Image($rawfile(channel.avatar))
                .width(60)
                .height(60)
                .borderRadius(30)
                .onClick(() => {
                  router.pushUrl({
                    url: 'pages/ProfileCreator',
                    params: { id: channel.id.toString() }
                  })
                })

              Text(channel.name)
                .fontSize(12)
                .margin({ top: 8 })
                .maxLines(1)
                .textOverflow({ overflow: TextOverflow.Ellipsis })
                .width(70)
                .textAlign(TextAlign.Center)
            }
            .width(70)
            .margin({ right: 15 })
          }
          )}
        .padding({ top: 5, bottom: 5 })
      }
      .scrollable(ScrollDirection.Horizontal)
      .width('100%')
      .height(100)
    }
    .padding(15)
    .width('100%')
  }

  // æ„å»ºä¸ºä½ æ¨èéƒ¨åˆ†
  @Builder
  buildRecommendedSection() {
    Column() {
      // æ ‡é¢˜å’Œåˆ·æ–°
      Row() {
        Text('ä¸ºä½ æ¨è')
          .fontSize(18)
          .fontWeight(FontWeight.Bold)
          .layoutWeight(1)

        Text('åˆ·æ–°')
          .fontSize(14)
          .opacity(0.8)
          .onClick(() => {
            // åˆ·æ–°é€»è¾‘
          })
      }
      .width('100%')
      .margin({ bottom: 15 })

      // æ¨èåˆ—è¡¨
      Column() {
        ForEach(this.recommendedItems, (item: RecommendedItem) => {
          Row() {
            Image($rawfile(item.thumbnail))
              .width(120)
              .height(70)
              .borderRadius(8)
              .objectFit(ImageFit.Cover)

            Column() {
              Text(item.title)
                .fontSize(14)
                .fontWeight(FontWeight.Bold)
                .maxLines(2)
                .textOverflow({ overflow: TextOverflow.Ellipsis })
                .lineHeight(20)

              Text(item.info)
                .fontSize(12)
                .opacity(0.8)
                .margin({ top: 10 })
            }
            .height(70)
            .margin({ left: 15 })
            .layoutWeight(1)
            .justifyContent(FlexAlign.SpaceBetween)
          }
          .width('100%')
          .margin({ bottom: 15 })
          .onClick(() => {
            // è·³è½¬åˆ°è¯¦æƒ…é¡µ
          })
        })
      }
      .width('100%')
    }
    .padding(15)
    .width('100%')
  }

  // æ„å»ºåº•éƒ¨å¯¼èˆªé¡¹
  @Builder
  buildNavItem(id: string, icon: string, label: string, page: string) {
    Column() {
      Text(icon)
        .fontSize(24)

      Text(label)
        .fontSize(12)
    }
    .opacity(this.activeNav === id ? 1 : 0.7)
    .onClick(() => {
      this.activeNav = id
      if (page !== 'discover') {
        router.pushUrl({ url: `pages/${page}` })
      }
    })
  }

  // è·å–åˆ†ç±»åç§°
  private getCategoryName(category: string): string {
    const categoryMap: Record<string, string> = {
      'recommended': 'æ¨è',
      'hot': 'çƒ­é—¨',
      'music': 'éŸ³ä¹',
      'dance': 'èˆè¹ˆ',
      'game': 'æ¸¸æˆ',
      'food': 'ç¾é£Ÿ',
      'travel': 'æ—…è¡Œ'
    }
    return categoryMap[category] || category
  }
}

// æ•°æ®æ¨¡å‹
interface Channel {
  id: number
  name: string
  avatar: string
}

interface RecommendedItem {
  id: number
  title: string
  info: string
  thumbnail: string
}

interface TrendingCard {
  id: number
  title: string
  info: string
  image: string
}